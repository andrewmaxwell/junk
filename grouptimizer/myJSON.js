const url = 'https://myjson.dit.upm.es/api/bins/o7w';

const historical = {
  '2021-09-15':
    '1,2,3,5,7,10,11,13,15,17,19,20,21,23,24,26,27,29,30,32,34,36,39,41,45',
  '2021-09-08':
    '1,2,6,7,10,11,13,15,17,19,20,21,24,26,27,28,29,30,32,34,39,40,41,42,43,45',
  '2021-09-01':
    '1,2,6,7,10,13,15,17,19,20,21,24,25,26,27,28,30,32,34,39,40,41,45',
  '2021-08-25':
    '1,2,3,5,6,7,10,11,13,15,17,19,20,21,23,24,25,26,27,28,29,30,31,32,34,39,40,41,42,43,45',
  '2021-07-21': '1,2,3,7,9,16,17,18,19,20,21,28,29,30,32,34,35,44',
  '2021-06-16': '2,3,4,16,17,18,19,20,22,25,26,28,29,32,33,34,35',
  '2021-06-09': '1,2,3,7,13,16,17,18,19,20,21,22,24,25,26,27,28,29,32,34',
  '2021-05-26':
    '1,2,7,10,13,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,34',
  '2021-05-19': '1,2,3,15,16,17,18,19,20,22,23,26,29,30,32,34,35,38',
  '2021-05-12':
    '1,2,3,4,7,15,16,17,18,19,20,21,22,23,24,27,28,29,30,32,33,34,35',
  '2021-05-05': '1,2,7,15,16,18,19,20,22,23,24,26,27,28,29,30,32,35',
  '2021-04-28':
    '1,2,3,4,13,15,16,17,18,19,20,21,22,23,24,26,27,28,29,30,32,33,35',
  '2021-04-14': '1,2,3,7,10,15,17,19,20,21,23,24,26,28,29,30,32,34,35',
  '2021-02-03': '2,3,7,9,10,15,17,19,20,21,23,24,26,28,30,32,34,35,38',
};

export const updateMyJSON = async (people) => {
  const existing = await fetch(url).then((r) => r.json());
  const key = new Date().toISOString().slice(0, 10);
  const newData = {
    ...historical,
    ...(existing?.data ?? {}),
    [key]: people
      .filter((p) => !p.absent)
      .map((p) => p.id)
      .sort((a, b) => a - b)
      .join(','),
  };

  console.log('newData', newData);
  // fetch(url, {
  //   method: 'PUT',
  //   headers: {'Content-Type': 'application/json'},
  //   body: JSON.stringify({lastEdited: new Date(), data: newData}),
  // });

  return newData;
};
